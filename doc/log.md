25.10.9

完成自己的二维码编解码

完善文件选取功能

仍旧无法翻拍，还需要调整解码的图像处理参数





25.9.25

修改名称去掉test，改为类似encoder

取消部分encoder全局变量，改为参数输入

[^]: 这种东西就该写成类的，没经验属于是

加入tkinter方便跳出选择文件

添加workspace文件夹，修改运行逻辑，把创建文件夹的工作全部移出去





25.9.24

稍微修改参数，把bpf调整到1720，现在每张二维码塞了2304/2331的数据

```
程序运行完成
文件读取与分块: 0.01 秒
添加rs块: 2.89 秒
添加块头: 0.00 秒
生成二维码: 110.23 秒
生成视频: 42.88 秒
总耗时: 156.02 秒
编码速度: 178.95 kbps
```

尝试用4k 60fps进行录制解码，但是失败了结果如下

```
解码视频: 1934帧 [09:10,  3.51帧/s]
解析块头: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 858/858 [00:00<00:00, 61983.72it/s]
need blocks :398, but find missing block :131
missing block index is :[1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 32, 33, 38, 39, 40, 42, 43, 44, 45, 46, 47, 48, 50, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 72, 76, 83, 84, 86, 87, 91, 92, 93, 94, 96, 98, 99, 101, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 118, 119, 121, 122, 123, 132, 135, 138, 140, 141, 142, 144, 145, 146, 151, 152, 153, 155, 156, 157, 158, 159, 161, 167, 168, 169, 170, 171, 172, 173, 176, 177, 178, 179, 180, 181, 182, 186, 190, 195, 207, 231, 232, 238, 250, 253, 284, 286, 288, 291, 292, 293, 294, 295, 296, 298, 318, 380]
Traceback (most recent call last):
  File "e:\系统\文档\GitHub\ComputerNetwork_Project\src\decode_test.py", line 276, in <module>
    main()
    ~~~~^^
  File "e:\系统\文档\GitHub\ComputerNetwork_Project\src\decode_test.py", line 255, in main
    blocks = check_blocks(parsed_blocks, total_data_blocks, total_rs_blocks)
  File "e:\系统\文档\GitHub\ComputerNetwork_Project\src\decode_test.py", line 134, in check_blocks
    return decode_rs(parsed_blocks, total_data_blocks, total_rs_blocks)
  File "e:\系统\文档\GitHub\ComputerNetwork_Project\src\decode_test.py", line 180, in decode_rs
    raise RuntimeError("restore rs: data block is not enough, cannot restore")
RuntimeError: restore rs: data block is not enough, cannot restore
```

使用ztx的超级苹果结果如下

```
按组添加rs块: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 41.80it/s]
添加数据块头: 100%|████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:00<00:00, 16295.44it/s] 
生成二维码图片: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:05<00:00,  4.10it/s] 
生成视频: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:02<00:00, 11.39it/s]

程序运行完成
文件读取与分块: 0.01 秒
添加rs块: 0.05 秒
添加块头: 0.00 秒
生成二维码: 5.62 秒
生成视频: 2.16 秒
总耗时: 7.98 秒
编码速度: 174.96 kbps
```

```
解码视频: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 74/74 [00:02<00:00, 33.17it/s] 
解析块头: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████| 59/59 [00:00<00:00, 483328.00it/s] 
need blocks :20, but find missing block :2
missing block index is :[5, 7]
按组添加rs块: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  8.13it/s] 
写入文件: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00<00:00, 50021.51it/s] 

程序运行完成
解码视频帧耗时: 2.2779 秒
解析数据块耗时: 0.0009 秒
检查数据块耗时: 0.1238 秒
重建文件耗时: 0.0023 秒
总程序运行时间: 2.4049 秒
```

记录尝试优化解码速度，使用record0

mode=0

```
解码视频帧耗时: 49.6631 秒
```

mode=1

```
解码视频帧耗时: 47.5944 秒
```

mode=2

```
解码视频帧耗时: 44.7535 秒
```

```
解码视频帧耗时: 25.0437 秒
```

其中跳帧版本速度最快，成功率也还可以，就是不清楚帧率影响多大

但是用ztx的视频却是mode0最快，虽然差距不大



后面又尝试了几次自己的手机录，但只成功了record0一次，华为手机，如此不堪！？





25.9.14

完成了rs块逻辑，测试xmu.txt模拟设置第一块为None成功还原，测试输出如下

```
解码视频: 24帧 [00:03,  6.33帧/s]
解析块头: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 24/24 [00:00<00:00, 180724.05it/s] 
need blocks :5, but find missing block :1
missing block index is :[0]
按组添加rs块: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 20.30it/s] 
写入文件: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:00<00:00, 61862.89it/s] 

程序运行完成
解码视频帧耗时: 3.8127 秒
解析数据块耗时: 0.0008 秒
检查数据块耗时: 0.0915 秒
重建文件耗时: 0.0205 秒
总程序运行时间: 3.9257 秒
```

本来还想试试在有这个的基础下能不能压一压fps和repeat，但是我的设备太垃圾了，不压也读不出来，放弃了



25.9.11

借助ai完成了第一版使用qrcode和pyzbar进行编解码的程序，但是工作时间很慢

编解码jiheon.jpg, size = 682, 981b

编码运行：

```
程序运行完成
文件读取与分块: 0.01 秒
添加块头: 0.09 秒
生成二维码: 107.79 秒
生成视频: 40.87 秒
总耗时: 148.94 秒
```

解码运行：

```
程序运行完成
解码视频帧耗时: 329.9035 秒
解析数据块耗时: 0.0041 秒
检查数据块耗时: 0.0001 秒
重建文件耗时: 0.0030 秒
总程序运行时间: 329.9110 秒
```

主要时间消耗都在生成二维码和解析二维码上，后续可能得往这里优化